<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">

    {% block title %}<title>换乘车站调查</title>{% endblock %}

    {% block public_css %}
        <!-- Bootstrap core CSS -->
        <link href="{{ asset('bundles/luxueweb/css/bootstrap.min.css') }}" rel="stylesheet">

        <!-- Custom styles for this template -->
        <link href="{{ asset('bundles/luxueweb/css/bodystyle.css') }}" rel="stylesheet">
    {% endblock %}
    {% block private_css %}
    {% endblock %}



    {% block public_js %}

        <script type="text/javascript" src="{{ asset('bundles/luxueweb/js/vendor/bootstrap.min.js') }}"></script>
        <script type="text/javascript" src="{{ asset('bundles/luxueweb/js/vendor/jquery-1.11.2.min.js') }}"></script>
    {% endblock %}

</head>

<body>
    {% block main_container %}
    <div class="container">
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" style="font-size: large" href="">地铁换乘站数据分析与预测系统</a>
                </div>
                <!--end navbar-header-->
                <div id="navbar" class="navbar-collapse collapse">
                    <form class="navbar-form navbar-right">
                        <div class="form-group">
                            <input type="text" placeholder="邮箱/用户名" class="form-control">
                        </div>
                        <div class="form-group">
                            <input type="password" placeholder="密码" class="form-control">
                        </div>
                        <button type="submit" class="btn btn-primary">登 陆</button>
                    </form>
                </div><!--/.navbar-collapse -->
            </div>
        </nav>




        <!-- The justified navigation menu is meant for single line per list item.
             Multiple lines will require custom code not provided by Bootstrap. -->
        {% block nav_top %}
        <div class="masthead">
            <h3 class="text-muted"></h3>
            <nav>
                <ul class="nav nav-justified">
                    {% block nav %}
                    <li class="active"><a href="{{ url('luxue_web_default_dataget')}}">数据获取</a></li>
                    <li><a href="{{url('luxue_web_default_dataanalysis') }}">数据分析</a></li>
                    <li><a href="{{url('luxue_web_default_dataview')}}">结果可视化</a></li>
                    <li><a href="{{url('luxue_web_default_datapredict')}}">规划预测</a></li>
                    {% endblock %}
                </ul>
            </nav>
        </div>
        {% endblock nav_top %}

        {% block main_form %}

        <div class="row form-inline">
            <div class=" col-lg-2 form-group">
                <label for="subwayline">线路</label>
                <select class="form-control" id="subwayline" onchange="getStations()">
                    <option value="">--请选择--</option>
                </select>
            </div>
            <div class="col-lg-2 form-group">
                <label for="station">站名</label>
                <select class="form-control" id="station" >
                    <option value="">--请选择--</option>
                </select>
            </div>
            <div class="col-lg-2 form-group">
                <label for="poi">POI</label>
                <select class="form-control" id="poi">
                    <option>--请选择--</option>
                    <option>小区</option>
                    <option>旅游景点</option>
                    <option>写字楼</option>
                    <option>政府机构</option>
                    <option>购物中心</option>
                    <option>学校</option>
                    <option>医院</option>
                </select>
            </div>
            <div id="form-btn">
            <button  class=" btn btn-default btn-primary" style="margin-right: 40px" onclick="data_get()">百度地图数据获取</button>
            <button  class=" btn btn-default btn-primary" style="margin-right: 40px" onclick="data_get()">地铁官网数据获取</button>
            <button  class=" btn btn-default btn-primary" style="margin-right: 40px" onclick="data_get()">客流调查数据获取</button>

            </div>
        </div>
        {% endblock %}

        {% block map_display_js %}

                <div  id="allmap" ></div>


            <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=zhBo0S6b0PhKyhIKsKcoshe0"></script>
            <script type="text/javascript">


                function init(){
                    console.log("init!");
                    var map = new BMap.Map("allmap"); // 创建Map实例
                    var lng,lat,radius,POI;
                    lng = 116.404;
                    lat = 39.915;
                    radius = 1000;
                    POI = '小区';


                    var mPoint = new BMap.Point(lng,lat);//设置中心点坐标
                    map.enableScrollWheelZoom();
                    map.centerAndZoom(mPoint,15);

                    var circle = new BMap.Circle(mPoint,radius,{fillColor:"blue", strokeWeight: 1 ,fillOpacity: 0.3, strokeOpacity: 0.3});
                    map.addOverlay(circle);
                    var local =  new BMap.LocalSearch(map, {renderOptions: {map: map, autoViewport: false}});
                    local.searchNearby(POI,mPoint,radius);
                }

                init();


                function data_get(){
                    console.log("baidu map start!");
                    var stationname = $('#station').val().trim();

                    $.get("/index/"+stationname,function(data){

                        var stationinfo = JSON.parse(data);
                        console.log(stationinfo);

                        var lng,lat,radius,POI;
                        lng = stationinfo.Lng;
                        lat = stationinfo.Lat;
                        radius = stationinfo.Radius;
                        POI = $('#poi').val().trim();

                        var map = new BMap.Map("allmap"); // 创建Map实例
                        var mPoint = new BMap.Point(lng,lat);//设置中心点坐标
                        map.enableScrollWheelZoom();
                        map.centerAndZoom(mPoint,15);

                        var circle = new BMap.Circle(mPoint,radius,{fillColor:"blue", strokeWeight: 1 ,fillOpacity: 0.3, strokeOpacity: 0.3});
                        map.addOverlay(circle);
                        var local =  new BMap.LocalSearch(map, {renderOptions: {map: map, autoViewport: false}});
                        local.searchNearby(POI,mPoint,radius);

                    });

                }


                //操作数据库实现菜单联动


                $.get("/dataget/getSubwayLines", function(data){

                        console.log(data);
                        var lines=JSON.parse(data);//解析json字符串，得到lines对象
                        console.log(lines);
                        /*json.forEach(function(d,i)
                             {
                                 $("#subwayline").append("<option>"+d+"</option>");

                             });*/
                        for( var key in lines)//循环取出lines对象的所有属性对应的属性值
                        {
                            //console.log(json[key]);
                            $("#subwayline").append("<option>"+lines[key]+"</option>");
                        }
                });


                function getStations(){
                    var linesname = $('#subwayline').val().trim();
                    console.log(linesname);
                    if(linesname=="")
                    {
                        $("#station").empty().append("<option value=''>--请选择--</option>");
                    }
                    else
                    {
                        $.get("/dataget/getStations"+"/"+linesname, function(data){

                            console.log(data);
                            var json=JSON.parse(data);
                            console.log(json);
                            $("#station").empty().append("<option value=''>--请选择--</option>");
                            /*json.forEach(function(d,i)
                            {
                                $("#station").append("<option>"+d+"</option>");

                            });*/
                            for( var key in json)//循环取出lines对象的所有属性对应的属性值
                            {
                                //console.log(json[key]);
                                $("#station").append("<option>"+json[key]+"</option>");
                            }

                        });

                    }

                }
            </script>
        {% endblock %}

        {% block table_display %}
        <button type="submit" class="col-lg-1 btn btn-default btn-primary" style="margin-right: 40px;margin-top: 30px" onclick="">数据保存</button>
        {% endblock table_display %}
    </div>
    {% endblock main_container %}

    {% block private_js %}
    {% endblock %}
</body>
</html>